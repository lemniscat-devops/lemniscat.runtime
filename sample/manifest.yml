---
variables:
  - name: serviceLevel
    value: integ
  - name: resourceType
    value: st
  - name: serviceLevelShort
    value: ig
  - name: RGNAME
    value: ${{ nc.rgName }}
  - name: STNAME
    value: ${{ nc.stName }}
  - name: VNETNAME
    value: ${{ nc.vNetName }}
  - name: VNETRG
    value: ${{ nc.vNetRg }}
  - name: SUBNETNAME
    value: ${{ nc.subnetName }}
  - name: entityCode
    value: ${{ domain.code }}
  - name: location
    value: ${{ env.location }}
  - name: env1
    value: ${{ env.env1 }}
  - name: env3
    value: ${{ env.env3 }} 
  - name: customName
    value: ${{ appName }}
  - name: projectName
    value: ${{ nc.projectName }}
  - name: rgTags.product_name
    value: azure_storage_account
  - name: rgTags.product_scope
    value: ${{ scopeType }}
  - name: rgTags.product_owner
    value: ${{ ownerPrincipalName }}
  - name: rgTags.rbac_scope
    value: ${{ ownerPrincipalType }}
  - name: rgTags.product_service_level
    value: ${{ serviceLevel }}
  - name: productInstanceName
    value: ${{ STNAME }}
  - name: pepSubnetPrefix
    value: ${{ env.st_pepSubnetPrefix }}  
  - name: workspaceScope
    value: '/subscriptions/${{ env.subscriptionId }}/resourceGroups/${{ nc.rgName }}'
capabilities:
  code: null
  build: null
  test: null
  release: null
  deploy: null
  operate:
    - solution: Azure
      tasks:
        - template: C:\DEV\Onepoint\lemniscat\github\lemniscat.runtime\sample\set-parameters-file.yml
          displayName: 'Set parameters file'
        - template: C:\DEV\Onepoint\lemniscat\github\lemniscat.runtime\sample\set-workspace.yml
          displayName: 'Set workspace'
        - template: C:\DEV\Onepoint\lemniscat\github\lemniscat.runtime\sample\deploy-infra.yml
          displayName: 'Deploy infra'

        - task: terraform
          displayName: 'Terraform destroy'
          steps:
            - decom
          parameters:
            action: destroy
            tfPath: C:\DEV\Onepoint\Smartplace\Product.AzureStorage\src\terraform
            tfVarFile: C:\DEV\Onepoint\lemniscat\github\lemniscat.runtime\sample\variables.tfvars.json
  monitor: null
  plan: null
requirements:
  - name: lemniscat.plugin.terraform
    version: 0.1.0.20
  - name: lemniscat.plugin.powershell
    version: 0.1.0.13
  - name: lemniscat.plugin.filetransform
    version: 0.1.0.3
  - name: lemniscat.plugin.azurecli
    version: 0.1.0.7