---
variables:
  - name: serviceLevel
    value: integ
  - name: resourceType
    value: st
  - name: serviceLevelShort
    value: ig
  - name: RGNAME
    value: ${{ nc.rgName }}
  - name: STNAME
    value: ${{ nc.stName }}
  - name: VNETNAME
    value: ${{ nc.vNetName }}
  - name: VNETRG
    value: ${{ nc.vNetRg }}
  - name: SUBNETNAME
    value: ${{ nc.subnetName }}
  - name: entityCode
    value: ${{ domain.code }}
  - name: location
    value: ${{ env.location }}
  - name: customName
    value: ${{ appName }}
  - name: rgTags.product_name
    value: azure_storage_account
  - name: rgTags.product_scope
    value: ${{ scopeType }}
  - name: rgTags.product_owner
    value: ${{ principalName }}
  - name: rgTags.rbac_scope
    value: ${{ principalType }}
  - name: rgTags.product_service_level
    value: ${{ serviceLevel}}
  - name: productInstanceName
    value: ${{ STNAME }}
  - name: pepSubnetPrefix
    value: ${{ env.st_pepSubnetPrefix }}  
capabilities:
  code: null
  build: null
  test: null
  release: null
  deploy: null
  operate:
    - solution: Azure
      tasks:
        - template: C:\DEV\Onepoint\lemniscat\github\lemniscat.runtime\sample\tmplate.yml
        - task: filetransform
          displayName: 'Set tfvars'
          steps:
            - pre
          parameters:
            folderPath: C:\DEV\Onepoint\lemniscat\github\lemniscat.runtime\sample
            fileType: json
            targetFiles: "*.tfvars.json"
        - task: terraform
          displayName: 'Terraform init'
          steps:
            - pre
            - run
            - decom
          parameters:
            action: init
            tfPath: C:\DEV\Onepoint\Smartplace\Product.AzureStorage\src\terraform
        - task: terraform
          displayName: 'Terraform plan'
          steps:
            - pre
          parameters:
            action: plan
            tfPath: C:\DEV\Onepoint\Smartplace\Product.AzureStorage\src\terraform
            tfVarFile: C:\DEV\Onepoint\lemniscat\github\lemniscat.runtime\sample\variables.tfvars.json
        - task: terraform
          displayName: 'Terraform apply'
          steps:
            - run
          parameters:
            action: apply
            tfPath: C:\DEV\Onepoint\Smartplace\Product.AzureStorage\src\terraform
        - task: terraform
          displayName: 'Terraform destroy'
          steps:
            - decom
          parameters:
            action: destroy
            tfPath: C:\DEV\Onepoint\Smartplace\Product.AzureStorage\src\terraform
            tfVarFile: C:\DEV\Onepoint\lemniscat\github\lemniscat.runtime\sample\variables.tfvars.json
  monitor: null
  plan: null
requirements:
  - name: lemniscat.plugin.terraform
    version: 0.1.0.9
  - name: lemniscat.plugin.powershell
    version: 0.1.0.9
  - name: lemniscat.plugin.filetransform
    version: 0.1.0.1